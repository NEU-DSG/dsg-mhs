!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-force"),require("d3-selection"),require("d3-transition"),require("d3-scale")):"function"==typeof define&&define.amd?define(["exports","d3-force","d3-selection","d3-transition","d3-scale"],e):(t=t||self,e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3))}(this,function(t,e,r,n,o){"use strict";function i(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function a(){return a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},a.apply(this,arguments)}function c(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function u(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?c(Object(r),!0).forEach(function(e){i(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function s(t){var e,r,n,o,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=t.target.x-t.source.x,c=t.target.y-t.source.y,u=Math.atan2(c,a);return i?(e=t.source.x+Math.cos(u)*t.source.r,r=t.source.y+Math.sin(u)*t.source.r,n=t.target.x-Math.cos(u)*t.target.r,o=t.target.y-Math.sin(u)*t.target.r):(e=t.source.x,r=t.source.y,n=t.target.x-Math.cos(u)*t.target.r,o=t.target.y-Math.sin(u)*t.target.r),"M"+e+","+r+"L"+((n-e)/2+e)+","+((o-r)/2+r)+"L"+n+","+o}function l(t,e){return"year"===e?t.addYears(1):"month"===e?t.addMonths(1):"day"===e?t.addDays(1):"week"===e?t.addWeeks(1):"hour"===e?t.addHours(1):"minute"===e?t.addMinutes(1):"second"===e?t.addSeconds(1):"millisecond"===e?t.addMilliseconds(1):void 0}function d(t,e,r){t=new Date(t),e=new Date(e);for(var n=new Array,o=t;o<=e;)n.push(o),o=l(o,r);return n}function f(t){function n(n){function x(t,e,n){function o(t){return t.id}function i(t){return t.source.id+"-"+t.target.id}function a(t){t.each(function(t){t.bbox=this.getBBox()})}function c(t){l(k,w,t,{hover_textOpacity:0,hover_strokeOpacity:.2})}function u(){d(k,w)}function l(t,e,r,n){function o(t,e){return h["".concat(t.id,",").concat(e.id)]||h["".concat(e.id,",").concat(t.id)]||t.id===e.id}var i=n.hover_textOpacity,a=n.hover_strokeOpacity;t.selectAll(".node").attr("opacity",function(t){return o(r,t)?1:a}).style("pointer-events",function(t){return o(r,t)?"auto":"none"}),t.selectAll(".root-label").attr("opacity",function(t){return o(r,t)?1:i}),t.selectAll(".node-label").attr("opacity",function(t){return o(r,t)?1:i}),e.selectAll(".link").attr("opacity",function(t){return t.source===r||t.target===r?1:a}),e.selectAll(".edge-label").attr("opacity",function(t){return t.source===r||t.target===r?.5:i})}function d(t,e){t.selectAll(".node").attr("opacity",O.nodeOpacity).style("pointer-events","auto"),t.selectAll(".root-label").attr("opacity",1),t.selectAll(".node-label").attr("opacity",O.nodeTextOpacity),e.selectAll(".link").attr("opacity",1),e.selectAll(".edge-label").attr("opacity",O.linkTextOpacity)}var f=n.root,p=n.rootparent,x=n.berects,g=r.select(y).select(".nodes"),v=r.select(y).select(".links"),k=g.selectAll("g").data(t,function(t){return o(t)});k.exit().select("circle").transition().duration(O.transitionDuration).attr("r",0).remove(),k.exit().select("rect").transition().duration(O.transitionDuration).attr("width",0).attr("height",0).remove(),k.exit().select("text").remove(),k.exit().transition().duration(O.transitionDuration).remove();var b=k.enter().append("g").attr("id",function(t){return"node-group-"+o(t)});b.attr("transform",function(t){return x(t)?"parent"===t.type?"translate("+(t.x0-t.radius+t.strokeWidth)+","+(t.y0-t.radius+t.strokeWidth)+")":"translate("+(t.x0-t.radius)+","+(t.y0-t.radius)+")":"translate("+t.x0+","+t.y0+")"}),b.filter(function(t){return!x(t)}).append("circle").attr("class","node node-circle").attr("id",function(t){return"node-"+t.id}).attr("stroke-width",function(t){return t.strokeWidth}).attr("stroke",function(t){return t.strokeColor}).attr("opacity",function(t){return t.opacity}).attr("fill",function(t){return t.color}),b.filter(function(t){return x(t)}).append("rect").attr("class","node node-rect").attr("id",function(t){return"node-"+t.id}).attr("stroke-width",function(t){return t.strokeWidth}).attr("stroke",function(t){return t.strokeColor}).attr("opacity",function(t){return t.opacity}).attr("fill",function(t){return t.color}),b.filter(function(t){return!f(t)}).append("text").attr("class","node-label").attr("font-size","".concat(O.nodeTextSize,"px")).attr("text-anchor","middle").attr("fill",O.nodeTextFill).attr("opacity",O.nodeTextOpacity).attr("x",function(t){return x(t)?t.radius:0}).attr("y",function(t){return x(t)?-10:-t.radius-8}).text(function(t){return"".concat(t.id)});var m=b.filter(function(t){return f(t)});m.append("text").attr("class","root-label").attr("font-size","".concat(2*O.nodeTextSize,"px")).attr("text-anchor","middle").attr("fill",O.nodeTextFill).attr("opacity",1).attr("x",function(t){return x(t)?t.radius:0}).attr("y",function(t){return x(t)?-10:-t.radius-10}).text(function(t){return"".concat(t.id)}).call(a),m.insert("rect","text").attr("x",function(t){return x(t)?t.radius+t.bbox.x:0+t.bbox.x}).attr("y",function(t){return x(t)?-25:-t.radius-10-15}).attr("width",function(t){return t.bbox.width}).attr("height",function(t){return t.bbox.height}).style("fill",O.nodeFill).style("opacity",.8),k=b.merge(k),k.transition().duration(O.transitionDuration).attr("transform",function(t){return x(t)?"translate("+(t.x-t.radius)+","+(t.y-t.radius)+")":"translate("+t.x+","+t.y+")"}),k.selectAll(".node-circle").call(function(t){t.transition().attr("r",function(t){return t.radius}).attr("fill",function(t){return t.color}).attr("stroke",function(t){return t.strokeColor})}),k.selectAll(".node-rect").call(function(t){t.transition().attr("width",function(t){return 2*t.radius}).attr("height",function(t){return 2*t.radius}).attr("fill",function(t){return t.color}).attr("stroke",function(t){return t.strokeColor})}),k.selectAll(".nodeFO").call(function(t){t.transition().attr("x",0).attr("y",0).attr("width",function(t){return 2*t.radius-t.strokeWidth}).attr("height",function(t){return 2*t.radius-t.strokeWidth}).attr("transform",function(t){return"translate("+-t.radius+","+-t.radius+")"})}),k.selectAll(".node").on("mouseover.fade",function(t){return c(t)}).on("mouseout.fade",function(){return u()}),k.selectAll(".node").filter(function(t){return p(t)});var w=v.selectAll("g").data(e,function(t){return i(t)});w.exit().select("path").transition().duration(O.transitionDuration).attr("d",function(t){return s({source:{x:t.source.x,y:t.source.y,r:0},target:{x:t.source.x,y:t.source.y,r:0}},"root"!==t.source.type)}).attr("opacity",0).remove(),w.exit().transition().duration(O.transitionDuration).remove();var D=w.enter().append("g").attr("id",function(t){return"path-group-"+i(t)});D.append("path").attr("class","link").attr("id",function(t){return"path-"+i(t)}).attr("stroke-width",function(t){return t.strokeWidth}).attr("stroke",function(t){return t.strokeColor}).attr("opacity",function(t){return t.opacity}).attr("d",function(t){return s({source:{x:t.source.x0,y:t.source.y0,r:t.source.radius},target:{x:t.target.x0,y:t.target.y0,r:t.target.radius}},"root"!==t.source.type)}),D.append("text").attr("class","edge-label").attr("font-size","".concat(O.linkTextSize,"px")).attr("text-anchor","middle").attr("fill",O.linkTextFill).attr("opacity",O.linkTextOpacity).attr("dy",-2).append("textPath").attr("xlink:href",function(t){return"#path-"+i(t)}).attr("startOffset","50%").text(function(t){return"".concat(t.label)}),w=D.merge(w),w.selectAll(".link").transition().duration(O.transitionDuration).attr("opacity",function(t){return t.opacity}).attr("d",function(t){return s({source:{x:t.source.x,y:t.source.y,r:t.source.radius},target:{x:t.target.x,y:t.target.y,r:t.target.radius}},"root"!==t.source.type)})}function g(t,e){function r(t){return a(t)?"root":c(t)?"parent":s(t)?"children":void 0}var n=t.filter(function(t){return void 0!==t.root}).map(function(t){return t.id}),o=[],i=[];t.map(function(t){0===e.filter(function(e){return e.start_id===t.id}).map(function(t){return t.end_id}).length?i.push(t.id):-1===n.indexOf(t.id)&&o.push(t.id)});var a=function(t){return-1!==n.indexOf(t.id)},c=function(t){return-1!==o.indexOf(t.id)},u=function(t){return-1!==o.concat(n).indexOf(t.id)},s=function(t){return-1!==i.indexOf(t.id)},l=function(){},d={root:a,parent:c,child:s,rootparent:u,berects:l};return t.forEach(function(t){t.type=r(t)}),e.forEach(function(e){e.type=t.find(function(t){return t.id===e.start_id}).type}),t.forEach(function(t){t.radius=O.radiusAccessor(t),t.color=O.nodeColorAccessor(t),t.strokeColor=O.nodeColorAccessor(t),t.opacity=O.nodeOpacityAccessor(t),t.strokeWidth=O.nodeStrokeWidth}),e.forEach(function(t){t.strokeColor=O.linkColorAccessor(t),t.strokeWidth=O.linkWidthAccessor(t),t.opacity=O.linkOpacityAccessor(t),t.strength=O.strengthAccessor(t)}),{nodes:t,links:e,accessors:d}}function v(e,r){t.stop();var n=r.nodes,o=r.links,i=r.date,a=e.nodes.filter(function(t){return t.date>i.getTime()}),c=e.links.filter(function(t){return t.date>i.getTime()});n=e.nodes.filter(function(t){return-1==a.map(function(t){return t.id}).indexOf(t.id)}),o=e.links.filter(function(t){return-1==c.map(function(t){return t.id}).indexOf(t.id)});var u=n.map(function(t){return t.id});o=o.filter(function(t){return-1!==u.indexOf(t.start_id)&-1!==u.indexOf(t.end_id)});var s=g(n,o);n=s.nodes,o=s.links,o.forEach(function(t){t.source=n.find(function(e){return e.id===t.start_id}),t.target=n.find(function(e){return e.id===t.end_id})}),o.forEach(function(t){h["".concat(t.source.id,",").concat(t.target.id)]=1}),n.forEach(function(t){var e={x:M.width/2,y:M.height/2};t.x=t.x?t.x:e.x,t.y=t.y?t.y:e.y,t.fx="root"==t.type?e.x:void 0,t.fy="root"==t.type?e.y:void 0,t.x0=t.x,t.y0=t.y}),t.nodes(n),t.force("link").links(o),t.alpha(.3).restart();for(var l=0;l<300;++l)t.tick();return n.forEach(function(t){t.x0=t.x,t.y0=t.y}),x(n,o,s.accessors),{nodes:n,links:o}}var k=a({},n),O=u(u({},b),c),m=l,w=m.mode,D=m.step,A=m.show_time,M={width:o,height:i};t=t||e.forceSimulation();var T=d(f,p,D),j=T[0],W=T[T.length-1];k.date=j;var _=a({},k);if(r.select(y).select("svg").empty()){!0===A&&r.select(y).append("h1").attr("class","timeHeader");var S=r.select(y).append("svg").attr("class","networkWrapper").attr("width",M.width).attr("height",M.height).attr("fill","transparent"),C=S.append("g").attr("class","network");C.append("g").attr("class","links"),C.append("g").attr("class","nodes")}if(null===w)v(k,_);else if("auto"===w){var P,E,F={playing:!0,status:"play",initial:!0},z=T.map(function(t){return t});if(z=z.filter(function(t){return t>=j&t<=W}),E=F.initial?0:z.indexOf(_.date),F.playing&&(P=setInterval(function(){_.date=T[E],r.select(".timeHeader").html(_.date);var t=v(k,_);_.nodes=t.nodes,_.links=t.links,++E>z.length-1&&(clearInterval(P),F={playing:!1,status:"end",initial:!0})},1e3)),!1===F.playing&"pause"===F.status){clearInterval(P),_.date=T[E];var H=v(k,_);_.nodes=H.nodes,_.links=H.links}if(!1===F.playing&"end"===F.status){clearInterval(P),_.date=T[z.length-1];var q=v(k,_);_.nodes=q.nodes,_.links=q.links}}else if("step"===w){var I=v(k,_);setTimeout(function(){_.date=W,_.nodes=I.nodes,_.links=I.links,v(k,_)},1e3)}}var o=800,i=800,c={},l={mode:null,step:"day",show_time:"false"},f=new Date,p=new Date,y="body",h=[];return n.selector=function(t){return arguments.length?(y=t,n):y},n.width=function(t){return arguments.length?(o=t,n):o},n.height=function(t){return arguments.length?(i=t,n):i},n.start=function(t){return arguments.length?(f=t,n):f},n.end=function(t){return arguments.length?(p=t,n):p},n.style=function(t){return arguments.length?(c=t,n):c},n.animation=function(t){return arguments.length?(l=t,n):l},n}var p=o.scaleOrdinal().range(["#E10100","#00bcd4","#3f51b5"]).domain(["root","parent","children"]),y=function(t){return 3},h=function(){return 1},x=function(t){return p(t.type)},g=function(){return 2},v=function(){return 1},k=function(){return"gray"},O=function(){return.5},b={nodeStrokeWidth:2,nodeTextOpacity:.8,nodeTextSize:12,nodeTextFill:"gray",linkTextOpacity:0,linkTextSize:8,linkTextFill:"gray",transitionDuration:750,radiusAccessor:y,nodeOpacityAccessor:h,nodeColorAccessor:x,linkWidthAccessor:g,linkOpacityAccessor:v,linkColorAccessor:k,strengthAccessor:O};Date.prototype.addYears=function(t){var e=new Date(this.valueOf());return e.setFullYear(e.getFullYear()+t),e},Date.prototype.addMonths=function(t){var e=new Date(this.valueOf());return e.setMonth(e.getMonth()+t),e},Date.prototype.addDays=function(t){var e=new Date(this.valueOf());return e.setDate(e.getDate()+t),e},Date.prototype.addWeeks=function(t){var e=new Date(this.valueOf());return e.setDate(e.getDate()+7*t),e},Date.prototype.addHours=function(t){var e=new Date(this.valueOf());return e.setHours(e.getHours()+t),e},Date.prototype.addMinutes=function(t){var e=new Date(this.valueOf());return e.setMinutes(e.getMinutes()+t),e},Date.prototype.addSeconds=function(t){var e=new Date(this.valueOf());return e.setSeconds(e.getSeconds()+t),e},Date.prototype.addMilliseconds=function(t){var e=new Date(this.valueOf());return e.setMilliseconds(e.getMilliseconds()+t),e},t.network=f,Object.defineProperty(t,"__esModule",{value:!0})});